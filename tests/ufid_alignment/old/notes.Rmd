---
title: "Alignment of features in the ES database using the ufid system"
output: html_notebook
---

```{r setup, warning=FALSE}
library(ufid)
library(ggplot2)
library(dplyr)
library(knitr)
library(elastic)
```

# Introduction

Features are aligned by asigning a ufid (universal feature id). `script_assing_ufids.R` automatically processes all the features in the database and builds the ufid-db, which stores mz,rt, ms1 and ms2 information for each ufid.

```{r}
index <- "g2_nts1_bfg"
path_ufid_db <- "~/projects/ufid/tests/ufid1.sqlite"
config_path <- "~/projects/config.yml"
ec <- config::get("elastic_connect", file = config_path)
escon <- elastic::connect(host = '10.140.73.204', user=ec$user, pwd=ec$pwd)

udb <- DBI::dbConnect(RSQLite::SQLite(), path_ufid_db)

```

```{r, results='asis'}
kable(tbl(udb, "feature") %>% select(ufid, mz, compound_name) %>% collect() %>% head())
```
At the moment there are `r tbl(udb, "feature") %>% collect() %>% nrow()` ufids in the ufid-db. 

To create a new ufid a clustering approach is taken based on mz, rt, ms1 and ms2. At this time no further clusters could be found in the `g2_dbas_v4_bfg` index. 

# Estimating error of the overall process

The current evaluation of the `g2_dbas_v4_bfg` index was done using the following parameters

```{r, results='asis', echo=FALSE}
kable(t(data.frame(
  "Min_number_features_in_cluster" = 10,
  "mz_tolerance" = "7 mDa",
  "rt_tolerance" = "1 min",
  "ms1_threshold" = 10,
  "ms2_threshold" = 50
)))
```

Currently, a feature must have mz, rt, ms1 and ms2 fields to even be considered (level 1 ufid).

## False negatives

An FN is defined as a feature which was not assigned a ufid even though it contained all the necessary fields. The number of features in the index which satisfy the criteria is 146237.

```{json}
GET g2_dbas_v4_bfg/_count
{
  "query": {
    "bool": {
      "filter": [
        {
          "exists": {
            "field": "mz"
          }
        },
        {
          "exists": {
            "field": "rt"
          }
        },
        {
          "nested": {
            "path": "ms2",
            "query": {
              "exists": {
                "field": "ms2.mz"
              }
            }
          }
        },
        {
          "nested": {
            "path": "ms1",
            "query": {
              "exists": {
                "field": "ms1.mz"
              }
            }
          }
        }
      ]
    }
  }
}
```

The number of feature with a ufid which is not equal to 0 is 128464

```{json}
GET g2_dbas_v4_bfg/_count
{
  "query": {
    "bool": {
      "filter": [
        {
          "exists": {
            "field": "ufid"
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "ufid": {
              "value": 0
            }
          }
        }
      ]
    }
  }
}
```

This gives us a percentage of false negatives of `r round(100*(1-(128464/146237)))`%. This is a little higher that I would like. Can we do better?

### Why are false negatives occurring

Let's take the example Sulisobenzone. This has 414 neg mode docs in es but no entry in the ufid-db. Average mz is 307.0287 stdev 0.006. rt is 7.3 stdev 0.08. This should be good enough to find 50 features with the clustering. Okay the issue was it never got to Sulisobenzone, since the first clustering did not require MS2 but the second one did, it just got stuck on some compound with many docs but without MS2s. Added MS2 requirement from the get-go.

#### After the adjustment

FN after fixing the `udb_new_ufid` function is `r round(100*(1-140855/146237))`%, which is significantly better! 


## False positives

An FP is a feature which has been incorrectly assigned to the wrong ufid. In other words, if you have a ufid where there is more than one compound, one of these must be a false positive. In some cases it is not possible to distinguish features since they are isomers of one another and extremely similar. 

This can only be done for 10000 features. 

```{r}
index <- "g2_dbas_v4_bfg"
config_path <- "~/projects/config.yml"
ec <- config::get("elastic_connect", file = config_path)
escon <- elastic::connect(host = '10.140.73.204', user=ec$user, pwd=ec$pwd)
```

Percentage of ufids with more than one compound (not % FP!):
```{r}
res <- Search(escon, index, body = '
              {
  "query": {
    "bool": {
      "filter": [
        {
          "exists": {
            "field": "ufid"
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "ufid": {
              "value": 0
            }
          }
        }
      ]
    }
  },
  "size": 0,
  "aggs": {
    "ufids": {
      "terms": {
        "field": "ufid",
        "size": 200
      },
      "aggs": {
        "comp_count": {
          "cardinality": {
            "field": "name"
          }
        }
      }
    }
  }
}
              ')

res2 <- sapply(res$aggregations$ufids$buckets, function(x) x$comp_count$value)
round(100 * sum(res2 > 1) / length(res2))
```

Percentage of false positive assignments:

```{r}
res <- Search(escon, index, body = '
{
  "query": {
    "bool": {
      "filter": [
        {
          "exists": {
            "field": "ufid"
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "ufid": {
              "value": 0
            }
          }
        }
      ]
    }
  },
  "size": 0,
  "aggs": {
    "ufids": {
      "terms": {
        "field": "ufid",
        "size": 200
      },
      "aggs": {
        "comps": {
          "terms": {
            "field": "name",
            "size": 10
          }
        }
      }
    }
  }
}
              ')
res2 <- lapply(res$aggregations$ufids$buckets, function(x) x$comps$buckets)
res3 <- sapply(res2, function(x) {
  if (length(x) == 0)
    return(0)
  eachlength <- sapply(x, function(y) y$doc_count)
  eachlength <- eachlength[-which.max(eachlength)]
  return(sum(eachlength))
})
tot <- res$hits$total$value
round(100 * sum(res3) / tot)
```

This is a fantastic result. It includes the situations where the system will never be able to resolve peaks because of their similarity. Great job R! The god of fortune has spoken.


```{r}
DBI::dbDisconnect(udb)
```


# Now do the same with non-targets

A new index (`g2_nts_bfg`) was created with non-targets from the first 4 months of 2021 (Rhine/Ko., daily mixed samples).

The ufid field will be filled for those documents with an MS2 spectrum.

First attempt did not work. No new ufids were added. The udb_distance function is not able to find clusters because the 50 feature matching limit in the first clustering was too high. lowered it to 10 features.


Before adding new ufid, you might want to double check that no current ufid matches... possible todo

At the moment will only add name to ufid db if all docs have a name associated, might want to loosen this restriction in the future.

There are too many different compounds, the random selection of 10000 features results in only a few features of one compound. This means the clustering often does not find enough features in a group.

2 solutions: 1) Increase the number of features collected for the first clustering beyond 10000...
2) Decrease the number of features needed for a cluster in the second stage clustering ... to 5
3) do the first clustering in domains, e.g. by sorting on mz and rt

solution 2 is easier so try that first...didn't help much as expected

Trying solution 3...

At some stage you will always run into the problem that you are continually accessing the same features in the first clustering. If you find no clusters you need to iterate the call multiple times collecting the next set of 10000 features...this is done using the "search_after" parameter using the "sort" values in the last hit.

That worked. After a bunch of iterations and changing of the order of things. It seems to have worked

## False negatives

features with mz, rt, ms1 and ms2 but no assigned ufid.

in total 79836 features. 61659 have ms2. 7012 have ms2 but no ufid, 11%.

Lets look at some examples...

Case of 134.07@7, 4 or 5 Methylbenzotriazol, one feature was not assigned probably due to mismatch of ms2

The ms2 of the UFID is very strange though... it shows a high 78 fragment which is not in the overlay and is not in the standard spectrum...

Need to check creation of averaged spectra again...


25189/79836 in total, 31% of total features have no ufid, regardless of if they have ms2 or not.

False positives... how do you calculate these?

21-11-25

New ufid assignment was done. Here are some numbers
Number of features: 186884
Number of features with ms2: 141846 (76%)
Number of features with ufid: 112058 (21% false negative)
Number of ufids: 1841

The second pass over ufid-db did not work. DB disconnected priviously for some reason.

21-11-29

Database was uploaded again and everything done again

Create a function to analyze the database. Number of features, fp, etc.



```{r}
analyze_esdb(escon, udb)
```
$total_features
[1] 192429

$total_features_with_ms2
[1] 145962

$percentage_with_ms2
[1] 76

$total_features_with_ufid
[1] 71803

$percentage_ms2_features_with_ufid_fn
[1] 49

What???? What happened to FN? It was much better before.

Need to create one place where all the settings are configured:
## Use of config file

The file config.yml contains all the settings for different configurations. To set the current configuration use
```{r, eval=FALSE}
Sys.setenv(R_CONFIG_ACTIVE = "default")
config::is_active("default")
config::get("mztol_mda")
```

The `config.yml` file must be located in the current working directory.

Sitapliptin has 285 docs with ms2 but only 46 were assigned the ufid (1203)

MS2 looks very good...

MS1 is missing in many cases (probably because componentization did not find 13C)...

Removed ms1 comparison, just causing unnecessary complications...

```{r}
compute_fp_fn_esdb(escon, udb)
```
Not much better...

Amisulpride is the next candidate, why?
It is not finding enough features of one compound when selecting the 10000 features...
There are too many features in the database left without ufids...
but it shouldn't matter, it should keep repeating until they are all found...
I forgot to get rid of ms1 comparison in clustering....

```{r}
compute_fp_fn_esdb(escon, udb)
```
no improvement.

```{r}
compute_fp_fn_esdb(escon, udb)
```
Finally. 12% fn thank god.

Now, FP...

One name (and adduct) has multiple ufids or one ufid has multiple names.

For example Antipyrine in multiple ufids...

Unknown why. mz, rt and ms2 look okay. Removed ufids
1807
189
1619
1653

and started again. This time no problem... almost all antipyrine (with MS2) in one ufid...

calcualted fp by two types using annotated features only

```{r}
compute_fp_fn_esdb(escon, udb)
```

there seem to be a lot of compounds with multiple ufids... 
might be because I had to restart the process so many times. 

try again to redo a few compounds and see what happens
Tetrapropylammonium
Worked perfectly again.
So I will redo everything in the hope of reducing FP numbers.

first need to increase speed of es_assign_ufids. This takes FOREVER.

Clear all ufids in es

Run es_assign_ufids using profvis for first 5 ufids.

increased speed of es_assign_ufids. Deleted all ufids in both databases and starting again.



```{r}
compute_fp_fn_esdb(escon, udb)
```
# Some ufids are found multiple times in one sample

How many features are affected?

4% originally. Not so bad.

First plan to eliminate these. During ufid assignment the algorithm first checks that the ufid hasnt already been assigned and also makes sure that it is not assigning the ufid more than once to one file. 
The ufid is assigned to the most intense peak in the file. This is the simplest solution for now, in reality you need to do a second clustering here to assign the duplicates to new ufids. but it only affects 4% of the features (for now)

```{r, warning=FALSE}
compute_fp_fn_esdb(escon, udb, index)

# $total_features
# [1] 350425
# 
# $total_features_with_ms2
# [1] 232639
# 
# $percent_with_ms2
# [1] 66
# 
# $total_features_with_ufid
# [1] 208227
# 
# $percent_ms2_features_with_ufid
# [1] 90
# 
# $percent_fn
# [1] 10
# 
# $total_features_multiple_assignment
# [1] 10916
# 
# $percent_features_multiple_assignment
# [1] 5
# 
# $total_features_ufid_annotated
# [1] 16132
# 
# $percent_fp_multiple_names_by_ufid
# [1] 6
# 
# $percent_fp_multiple_ufids_by_name
# [1] 11
# 
# $percent_fp_sum
# [1] 17
# 
# $percent_fp_avg
# [1] 8
# 
# $names_multiple_ufids
#  [1] "O-desmethyl-venlafaxine"                "Tramadol"                              
#  [3] "Valsartanic acid"                       "Candesartan"                           
#  [5] "Valsartan"                              "Benzotriazole"                         
#  [7] "Irbesartan"                             "Atenolol acid"                         
#  [9] "Metolachlor ESA"                        "5-Methyl-1H-benzotriazole"             
# [11] "Repaglinide"                            "DEET"                                  
# [13] "Diclofenac"                             "Iopromide"                             
# [15] "Benzyl-triethylammonium"                "4-Hydroxyantipyrin"                    
# [17] "2`-Deoxyinosine"                        "O-desmethyl-tramadol"                  
# [19] "Tributyl phosphate"                     "Triisobutyl phosphate"                 
# [21] "Desamino-metamitron"                    "10-Hydroxycarbamazepine"               
# [23] "10,11-Dihydro-10,11-epoxycarbamazepine"
# 
# $ufids_multiple_names
# $ufids_multiple_names$ufid_903
# [1] "O-desmethyl-venlafaxine" "Tramadol"               
# 
# $ufids_multiple_names$ufid_2399
# [1] "O-desmethyl-venlafaxine" "Tramadol"                "N-desmethyl-venlafaxine"
# 
# $ufids_multiple_names$ufid_2074
# [1] "Fexofenadinone" "Carebastine"   
# 
# $ufids_multiple_names$ufid_310
# [1] "Caffeine"    "Isocaffeine"
# 
# $ufids_multiple_names$ufid_2396
# [1] "O-desmethyl-tramadol" "N-Desmethyltramadol" 
# 
# $ufids_multiple_names$ufid_871
# [1] "Tributyl phosphate"    "Triisobutyl phosphate"
# 
# $ufids_multiple_names$ufid_2401
# [1] "Tributyl phosphate"    "Triisobutyl phosphate"
# 
# $ufids_multiple_names$ufid_222
# [1] "1,7-Dimethylxanthine" "Theophylline"         "3,7-Dimethylxanthine"
# 
# $ufids_multiple_names$ufid_1224
# [1] "(Methoxymethyl)triphenylphosphonium"  "(2-Hydroxyethyl)triphenylphosphonium"
# 
# $ufids_multiple_names$ufid_148
# [1] "1-Methylguanine" "9-Methylguanine"
# 
# $ufids_multiple_names$ufid_753
# [1] "10,11-Dihydro-10,11-epoxycarbamazepine" "Oxcarbazepine" 
```


2022-01-01

There are some false matches causing errors.

A feature in the Merck dataset, similar to CBZ, was given the same ufid. The MS2 does not match.
The creation of the ufid db uses just one index! This is bad, since it concentrates the averaging just on the 5 detections in the hessen1 index (the last index to be used for averaging).

Solution: Change spectral averaging to include all available indexes.
Done. But this error could have affected many different ufids, redo entire ufid-db... (at some stage)


2022-01-03

Completed programming of the gap filling and tested it on 4 ufids (CBZ, Sitagliptin, two unknowns). 
Reprocessing of all ufids (just gap-filling). 

```{r, warning=FALSE}
compute_fp_fn_esdb(escon, udb, index)

# $total_features
# [1] 350425
# 
# $total_features_with_ufid
# [1] 257239
# 
# $percent_features_with_ufid
# [1] 73.40772
# 
# $percent_fn
# [1] 27
# 
# $total_features_with_ms2
# [1] 232639
# 
# $percent_with_ms2
# [1] 66
# 
# $percent_ms2_features_with_ufid
# [1] 89
# 
# $percent_ms2_fn
# [1] 11
# 
# $total_features_multiple_assignment
# [1] 10916
# 
# $percent_ufids_multiple_assignment
# [1] 4
# 
# $total_features_ufid_annotated
# [1] 18374
# 
# $percent_fp_multiple_names_by_ufid
# [1] 6
# 
# $percent_fp_multiple_ufids_by_name
# [1] 2
# 
# $percent_fp_sum
# [1] 8
# 
# $percent_fp_avg
# [1] 4
# 
# $names_multiple_ufids
# $names_multiple_ufids[[1]]
# [1] "O-desmethyl-venlafaxine"
# 
# $names_multiple_ufids[[2]]
# [1] "Tramadol"
# 
# $names_multiple_ufids[[3]]
# [1] "Atenolol acid"
# 
# $names_multiple_ufids[[4]]
# [1] "DEET"
# 
# $names_multiple_ufids[[5]]
# [1] "Benzyl-triethylammonium"
# 
# $names_multiple_ufids[[6]]
# [1] "4-Hydroxyantipyrin"
# 
# $names_multiple_ufids[[7]]
# [1] "O-desmethyl-tramadol"
# 
# $names_multiple_ufids[[8]]
# [1] "Tributyl phosphate"
# 
# $names_multiple_ufids[[9]]
# [1] "Triisobutyl phosphate"
# 
# $names_multiple_ufids[[10]]
# [1] "10-Hydroxycarbamazepine"
# 
# $names_multiple_ufids[[11]]
# [1] "10,11-Dihydro-10,11-epoxycarbamazepine"
# 
# $names_multiple_ufids[[12]]
# [1] "2,2,6,6-Tetramethylpiperidine"
# 
# 
# $ufids_multiple_names
# $ufids_multiple_names$ufid_903
# [1] "O-desmethyl-venlafaxine" "Tramadol"               
# 
# $ufids_multiple_names$ufid_2399
# [1] "O-desmethyl-venlafaxine" "Tramadol"               
# [3] "N-desmethyl-venlafaxine"
# 
# $ufids_multiple_names$ufid_2074
# [1] "Fexofenadinone" "Carebastine"   
# 
# $ufids_multiple_names$ufid_310
# [1] "Caffeine"    "Isocaffeine"
# 
# $ufids_multiple_names$ufid_222
# [1] "1,7-Dimethylxanthine" "Theophylline"         "3,7-Dimethylxanthine"
# 
# $ufids_multiple_names$ufid_2396
# [1] "O-desmethyl-tramadol" "N-Desmethyltramadol" 
# 
# $ufids_multiple_names$ufid_871
# [1] "Tributyl phosphate"    "Triisobutyl phosphate"
# 
# $ufids_multiple_names$ufid_2401
# [1] "Tributyl phosphate"    "Triisobutyl phosphate"
# 
# $ufids_multiple_names$ufid_1224
# [1] "(Methoxymethyl)triphenylphosphonium" 
# [2] "(2-Hydroxyethyl)triphenylphosphonium"
# 
# $ufids_multiple_names$ufid_148
# [1] "1-Methylguanine" "9-Methylguanine"
# 
# $ufids_multiple_names$ufid_753
# [1] "10,11-Dihydro-10,11-epoxycarbamazepine"
# [2] "Oxcarbazepine"                         
```

It's looking better but still a lot to do.

Many ufids are only found sporadically. Why?
There are several components with many different features... how should these be grouped?
The component information is lost since we are importing all features...

This is the next major issue to contend with. Obviously the componentisation information needs to be utilized better.

Perhaps only components should be added to the database.

2022-01-07

After bug fixes in componentisation the data was added again to ES. A complete reprocessing is needed. I think there is no need to start a new ufid database though. It should be enough just to rerun the assignment script.

After rerunning the assignment script the result is

```
$total_features
[1] 419006

$total_features_with_ufid
[1] 301214

$percent_features_with_ufid
[1] 71.88775

$percent_fn
[1] 28

$total_features_with_ms2
[1] 271632

$percent_with_ms2
[1] 65

$percent_ms2_features_with_ufid
[1] 89

$percent_ms2_fn
[1] 11

$total_features_multiple_assignment
[1] 1597

$percent_ufids_multiple_assignment
[1] 1

$total_features_ufid_annotated
[1] 18808

$percent_fp_multiple_names_by_ufid
[1] 6

$percent_fp_multiple_ufids_by_name
[1] 5

$percent_fp_sum
[1] 11

$percent_fp_avg
[1] 5

$names_multiple_ufids
 [1] "O-desmethyl-venlafaxine"                "Tramadol"                              
 [3] "Valsartanic acid"                       "Venlafaxine"                           
 [5] "Repaglinide"                            "Diphenylphosphine oxide"               
 [7] "Olmesartan"                             "Benzyl-triethylammonium"               
 [9] "4-Hydroxyantipyrin"                     "O-desmethyl-tramadol"                  
[11] "Pyridoxine"                             "Tributyl phosphate"                    
[13] "Triisobutyl phosphate"                  "1,7-Dimethylxanthine"                  
[15] "10-Hydroxycarbamazepine"                "Theophylline"                          
[17] "N-desmethyl-venlafaxine"                "10,11-Dihydro-10,11-epoxycarbamazepine"
[19] "2,2,6,6-Tetramethylpiperidine"          "N-Desmethyltramadol"                   
[21] "Tetraglyme"                             "5-(4-Hydroxyphenyl)-5-phenylhydantoin" 
[23] "3,7-Dimethylxanthine"                   "4-Aminoantipyrine"                     
[25] "2-Phenyl-2-imidazoline"                 "Repaglinide"                           
[27] "Sitagliptin-N-sulfate"                 

$ufids_multiple_names
$ufids_multiple_names$ufid_903
[1] "O-desmethyl-venlafaxine" "Tramadol"               

$ufids_multiple_names$ufid_2399
[1] "O-desmethyl-venlafaxine" "Tramadol"               

$ufids_multiple_names$ufid_2074
[1] "Fexofenadinone" "Carebastine"   

$ufids_multiple_names$ufid_310
[1] "Caffeine"    "Isocaffeine"

$ufids_multiple_names$ufid_222
[1] "1,7-Dimethylxanthine" "Theophylline"         "3,7-Dimethylxanthine"

$ufids_multiple_names$ufid_2396
[1] "O-desmethyl-tramadol" "N-Desmethyltramadol" 

$ufids_multiple_names$ufid_2401
[1] "Tributyl phosphate"    "Triisobutyl phosphate"

$ufids_multiple_names$ufid_1224
[1] "(Methoxymethyl)triphenylphosphonium"  "(2-Hydroxyethyl)triphenylphosphonium"

$ufids_multiple_names$ufid_4621
[1] "Diatrizoate"    "Iotalamic acid"

$ufids_multiple_names$ufid_148
[1] "1-Methylguanine" "9-Methylguanine"

$ufids_multiple_names$ufid_871
[1] "Tributyl phosphate"    "Triisobutyl phosphate"

$ufids_multiple_names$ufid_3939
[1] "N-Desmethyltramadol"  "O-desmethyl-tramadol"

$ufids_multiple_names$ufid_4887
[1] "Tributyl phosphate"    "Triisobutyl phosphate"

$ufids_multiple_names$ufid_3940
[1] "N-Desmethyltramadol"  "O-desmethyl-tramadol"

$ufids_multiple_names$ufid_4716
[1] "1,7-Dimethylxanthine" "3,7-Dimethylxanthine" "Theophylline"        

$ufids_multiple_names$ufid_753
[1] "10,11-Dihydro-10,11-epoxycarbamazepine" "Oxcarbazepine"  
```

There are clearly improvements necessary. But at least it worked again.

ucid attempts

22-01-09
ucid assignment seems to have worked
tested it using

```
GET g2_nts*/_search
{
  "query": {
    "match_all": {}
  },
  "size": 0,
  "aggs": {
    "ucids": {
      "terms": {
        "field": "ucid",
        "size": 100
      },
      "aggs": {
        "rt": {
          "extended_stats": {
            "field": "rt"
          }
        },
        "rt_sort": {
          "bucket_sort": {
            "sort": [
              {"rt.std_deviation": {"order": "desc"}}
            ]
          }
        }
      }
    }
  }
}
```
Max std_deviation was 0.3.
Also, it only took 2 hours.

# Adding data from Liza

Data is not clean yet, station and start not properly read. First attempt at alignment:
```{r}
index <- "g2_nts_expn"
ufid::es_test_fpfn(escon, udb, index)
```

## 2022-01-26

After adding data from April to Juli, found large numbers of FP which should not be happening.

e.g. Lamotrigine, ufid 778 (major) and 6139 (minor)

6139 is in every way the same. Both have MS2. 

It was deleted from elastic and from ufid-db.

Recluster from 255, 5 min

Problem was entry of duplicated data. This must be checked before processing.
Done using cardinality and runtime fields.

## 2022-01-28

```
$total_features
[1] 553019

$total_features_with_ufid
[1] 332292

$percent_features_with_ufid
[1] 60

$percent_fn
[1] 40

$total_features_with_ms2
[1] 355150

$percent_with_ms2
[1] 64

$percent_ms2_features_with_ufid
[1] 94

$percent_ms2_fn
[1] 6

$total_features_multiple_assignment
[1] 13028

$percent_ufids_multiple_assignment
[1] 4

$total_features_ufid_annotated
[1] 22762

$percent_fp_multiple_names_by_ufid
[1] 7

$percent_fp_multiple_ufids_by_name
[1] 4

$percent_fp_sum
[1] 10

$percent_fp_avg
[1] 5

$num_ucids
[1] 0

$max_rt_stddev_ucid
[1] 0

$names_multiple_ufids
$names_multiple_ufids[[1]]
[1] "O-desmethyl-venlafaxine"

$names_multiple_ufids[[2]]
[1] "Tramadol"

$names_multiple_ufids[[3]]
[1] "N-Ethyl-4-menthane-3-carboxamide"

$names_multiple_ufids[[4]]
[1] "Valsartanic acid"

$names_multiple_ufids[[5]]
[1] "DEET"

$names_multiple_ufids[[6]]
[1] "Venlafaxine"

$names_multiple_ufids[[7]]
[1] "O-desmethyl-tramadol"

$names_multiple_ufids[[8]]
[1] "Pyridoxine"

$names_multiple_ufids[[9]]
[1] "Tributyl phosphate"

$names_multiple_ufids[[10]]
[1] "Triisobutyl phosphate"

$names_multiple_ufids[[11]]
[1] "4-Hydroxyantipyrin"

$names_multiple_ufids[[12]]
[1] "Lidocaine"

$names_multiple_ufids[[13]]
[1] "N-Desmethyltramadol"

$names_multiple_ufids[[14]]
[1] "1,7-Dimethylxanthine"

$names_multiple_ufids[[15]]
[1] "Theophylline"

$names_multiple_ufids[[16]]
[1] "Celiprolol"

$names_multiple_ufids[[17]]
[1] "Ritalinic acid"

$names_multiple_ufids[[18]]
[1] "5`-Deoxy-5`-(methylthio)adenosin"

$names_multiple_ufids[[19]]
[1] "10,11-Dihydro-10,11-epoxycarbamazepine"

$names_multiple_ufids[[20]]
[1] "10-Hydroxycarbamazepine"

$names_multiple_ufids[[21]]
[1] "threo-Dihydrobupropion"

$names_multiple_ufids[[22]]
[1] "10,11-Dihydroxy-10,11-dihydrocarbamazepine"

$names_multiple_ufids[[23]]
[1] "2`-Deoxyguanosine"

$names_multiple_ufids[[24]]
[1] "Butyl-triphenylphosphonium"

$names_multiple_ufids[[25]]
[1] "Benzoyleneurea"

$names_multiple_ufids[[26]]
[1] "5-(4-Hydroxyphenyl)-5-phenylhydantoin"

$names_multiple_ufids[[27]]
[1] "3,7-Dimethylxanthine"

$names_multiple_ufids[[28]]
[1] "2-Phenyl-2-imidazoline"


$ufids_multiple_names
$ufids_multiple_names$ufid_817
[1] "O-desmethyl-venlafaxine" "Tramadol"               

$ufids_multiple_names$ufid_3841
[1] "O-desmethyl-venlafaxine" "Tramadol"               

$ufids_multiple_names$ufid_701
[1] "O-desmethyl-tramadol" "N-Desmethyltramadol" 

$ufids_multiple_names$ufid_312
[1] "Caffeine"    "Isocaffeine"

$ufids_multiple_names$ufid_5458
[1] "Fexofenadinone" "Carebastine"   

$ufids_multiple_names$ufid_848
[1] "Tributyl phosphate"    "Triisobutyl phosphate"

$ufids_multiple_names$ufid_221
[1] "1,7-Dimethylxanthine" "Theophylline"         "3,7-Dimethylxanthine"

$ufids_multiple_names$ufid_3673
[1] "O-desmethyl-tramadol" "N-Desmethyltramadol" 

$ufids_multiple_names$ufid_354
[1] "Desethylterbuthylazine" "Simazine"              

$ufids_multiple_names$ufid_4396
[1] "(Methoxymethyl)triphenylphosphonium"  "(2-Hydroxyethyl)triphenylphosphonium"

$ufids_multiple_names$ufid_149
[1] "1-Methylguanine" "9-Methylguanine"

$ufids_multiple_names$ufid_3882
[1] "Tributyl phosphate"    "Triisobutyl phosphate"

$ufids_multiple_names$ufid_3702
[1] "10,11-Dihydro-10,11-epoxycarbamazepine" "Oxcarbazepine"                         

$ufids_multiple_names$ufid_2992
[1] "3,7-Dimethylxanthine" "1,7-Dimethylxanthine" "Theophylline"      
```




```{r}
DBI::dbDisconnect(udb)
```

